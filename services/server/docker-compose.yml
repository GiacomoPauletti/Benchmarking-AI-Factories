version: '3.8'

services:
  server:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: benchmarking-ai-server
    ports:
      - "8001:8001"
    volumes:
      # Mount source code for hot-reload during development
      - ./src:/app/src
      - ./logs:/app/logs
      - ./huggingface_cache:/app/huggingface_cache
      # Mount SSH keys for MeluXina access (read-only)
      - ~/.ssh:/root/.ssh:ro
      # Mount SSH config if it exists
      - ~/.ssh/config:/root/.ssh/config:ro
    environment:
      # SSH Configuration for MeluXina
      - SSH_TUNNEL_HOST=${SSH_TUNNEL_HOST:-login.lxp.lu}
      - SSH_TUNNEL_USER=${SSH_TUNNEL_USER}
      
      # Application Configuration
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - PYTHONUNBUFFERED=1
    env_file:
      - .env.local
    network_mode: host
    stdin_open: true
    tty: true
    restart: unless-stopped
